var t=Object.defineProperty,e=Object.defineProperties,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(e,o,a)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,i=(t,e)=>{for(var o in e||(e={}))r.call(e,o)&&n(t,o,e[o]);if(a)for(var o of a(e))s.call(e,o)&&n(t,o,e[o]);return t};import{m as l,c as d,a as c,F as u,b as m,w as p,d as h,v as g,t as f,r as w,e as b,o as y,f as T,g as v,h as x}from"./vendor.14d02a49.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const o of t)if("childList"===o.type)for(const t of o.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const F={name:"App",data:()=>({loadingTodos:!1,loadingNewTodo:!1,loadingAdminEnter:!1,newTodoFormData:{username:"",email:"",text:""},newTodoFormValidationErrors:{username:"",email:"",text:""},adminEnterFormData:{username:"",password:""},adminEnterFormValidationErrors:{username:"",password:""}}),created(){this.$store.dispatch("todo/subscribeToTodos"),this.$store.dispatch("todo/loadParamsFromDocumentUrl"),this.$store.dispatch("auth/checkAuthed")},methods:{nextPage(){this.page<this.totalPages&&this.$store.commit("todo/pageMutation",this.page+1)},prevPage(){this.page>1&&this.$store.commit("todo/pageMutation",this.page-1)},toggleSort(t){this.$store.dispatch("todo/toggleSort",t)},validateNewTodoForm(){return this.clearNewTodoFormValidationErrors(),""===this.newTodoFormData.email?(this.newTodoFormValidationErrors.email="Обязательное поле",!1):(t=this.newTodoFormData.email,/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())?""===this.newTodoFormData.username?(this.newTodoFormValidationErrors.username="Обязательное поле",!1):""!==this.newTodoFormData.text||(this.newTodoFormValidationErrors.text="Обязательное поле",!1):(this.newTodoFormValidationErrors.email="Неверный формат email",!1));var t},clearNewTodoFormValidationErrors(){this.newTodoFormValidationErrors.username="",this.newTodoFormValidationErrors.email="",this.newTodoFormValidationErrors.text=""},clearNewTodoForm(){this.newTodoFormData.username="",this.newTodoFormData.email="",this.newTodoFormData.text=""},async createTodo(){if(this.validateNewTodoForm())try{this.loadingNewTodo=!0,await this.$store.dispatch("todo/createTodo",this.newTodoFormData),await this.loadTodos(),this.clearNewTodoForm(),alert("Задача создана")}catch{alert("Не удалось создать задачу")}finally{this.loadingNewTodo=!1}},async loadTodos(){try{this.loadingTodos=!0,await this.$store.dispatch("todo/fetchTodos"),this.page>this.totalPages&&(this.$store.commit("todo/pageMutation",this.totalPages),await this.$store.dispatch("todo/fetchTodos"))}catch{alert("Не удалось загрузить задачи")}finally{this.loadingTodos=!1}},validateAdminEnterForm(){return this.clearAdminEnterFormValidationErrors(),""===this.adminEnterFormData.username?(this.adminEnterFormValidationErrors.username="Обязательное поле",!1):""!==this.adminEnterFormData.password||(this.adminEnterFormValidationErrors.password="Обязательное поле",!1)},clearAdminEnterFormValidationErrors(){this.adminEnterFormValidationErrors.username="",this.adminEnterFormValidationErrors.password=""},clearAdminEnterForm(){this.adminEnterFormData.username="",this.adminEnterFormData.password=""},async login(){if(this.validateAdminEnterForm())try{this.loadingAdminEnter=!0,await this.$store.dispatch("auth/login",this.adminEnterFormData)}catch{alert("Неверный логин или пароль")}finally{this.clearAdminEnterForm(),this.loadingAdminEnter=!1}},logout(){this.$store.dispatch("auth/logout")},async toggleTodoCompletion(t){let e=t.status;t.status<10?e+=10:e-=10;try{this.loadingTodos=!0,this.loadingNewTodo=!0,await this.$store.dispatch("todo/updateTodo",{todoId:t.id,status:e,text:null}),await this.loadTodos()}catch{alert("Вы не авторизованы"),this.logout()}finally{this.loadingTodos=!1,this.loadingNewTodo=!1}},async changeTodoText(t,e){const o=t%2==0?t.status:t.status+1;try{this.loadingTodos=!0,this.loadingNewTodo=!0,await this.$store.dispatch("todo/updateTodo",{todoId:t.id,status:o,text:e.target.value}),await this.loadTodos()}catch{alert("Вы не авторизованы"),this.logout()}finally{this.loadingTodos=!1,this.loadingNewTodo=!1}}},computed:(E=i({},l({todos:"todo/todosGetter",totalTodosCount:"todo/totalTodosCountGetter",sortField:"todo/sortFieldGetter",sortDirection:"todo/sortDirectionGetter",isAuthed:"auth/isAuthedGetter"})),D={page(){return Number(this.$store.getters["todo/pageGetter"])},totalPages(){return Math.ceil(this.totalTodosCount/3)}},e(E,o(D))),watch:{page(){this.loadTodos()},sortField(){this.loadTodos()},sortDirection(){this.loadTodos()}}};var E,D;const k={class:"flex flex-col items-center w-full h-full py-5"},S={class:"xl:w-3/4 lg:w-5/6 sm:w-full sm:px-5"},A={class:"border border-gray-400 border-b-0 p-5 relative"},M={key:0,class:"flex flex-row items-baseline"},_=c("div",{class:"flex-grow p-2 border border-gray-400"}," Вы авторизованы как Администратор ",-1),V={key:0,class:"loading-overlay"},C={class:"flex flex-row items-baseline"},P={class:"border border-gray-400 p-2 w-full relative"},N={class:"absolute top-0 bottom-0 right-0 mr-5 text-red-400 flex flex-row items-center pointer-events-none"},G={class:"border border-gray-400 p-2 w-full border-l-0 relative"},O={class:"absolute top-0 bottom-0 right-0 mr-5 text-red-400 flex flex-row items-center pointer-events-none"},$=c("div",null,[c("label",null,[c("input",{type:"submit",class:"outline-none border border-gray-400 border-l-0 p-2 w-full cursor-pointer",style:{"margin-top":"-6px"},value:"Войти как администратор"})])],-1),j={class:"border border-gray-400 w-full p-5 relative"},U={key:0,class:"loading-overlay"},z={class:"border border-gray-400 w-full",style:{"min-height":"400px"}},L={class:"w-full"},I={key:0,style:{width:"100px"}},R=c("col",{style:{width:"200px"}},null,-1),q=c("col",{style:{width:"200px"}},null,-1),Z=c("col",{style:{"min-width":"120px"}},null,-1),K=c("col",{style:{width:"125px"}},null,-1),B={style:{"max-height":"32px"}},H={key:0,class:"data-table-cell"},J=b(" Имя пользователя "),Q={key:0},W={key:1},X=b(" E-mail "),Y={key:0},tt={key:1},et=c("td",{class:"data-table-header-cell"}," Текст задачи ",-1),ot=b(" Статус задачи "),at={key:0},rt={key:1},st={key:0,class:"data-table-cell"},nt=["checked","onClick"],it={class:"data-table-cell py-2"},lt={class:"data-table-cell"},dt={key:1,class:"data-table-cell text-left px-2"},ct=["value","onChange"],ut={key:2,class:"data-table-cell text-left px-2"},mt={class:"data-table-cell text-left px-2 py-2"},pt={class:"flex flex-row justify-between"},ht={key:0,class:"bg-yellow-300",style:{"border-radius":"30px",padding:"5px 10px"}},gt={key:1,class:"bg-green-300",style:{"border-radius":"30px",padding:"5px 10px"}},ft={class:"border-b border-l border-r border-gray-400 p-4 flex flex-row items-baseline space-x-4"},wt={class:"border border-gray-400 border-t-0 p-5 relative"},bt={key:0,class:"loading-overlay"},yt={class:"flex flex-col w-full"},Tt={class:"border border-gray-400 p-2 w-full border-b-0 relative"},vt={class:"absolute top-0 bottom-0 right-0 mr-5 text-red-400 flex flex-row items-center pointer-events-none"},xt={class:"border border-gray-400 p-2 w-full border-b-0 relative"},Ft={class:"absolute top-0 bottom-0 right-0 mr-5 text-red-400 flex flex-row items-center pointer-events-none"},Et={class:"border border-gray-400 p-2 w-full border-b-0 relative"},Dt={class:"absolute top-0 bottom-0 right-0 mr-5 text-red-400 flex flex-row items-center pointer-events-none"},kt=c("div",null,[c("label",null,[c("input",{type:"submit",class:"outline-none border border-gray-400 p-2 w-full cursor-pointer",style:{"margin-top":"-6px"},value:"Создать задачу"})])],-1);F.render=function(t,e,o,a,r,s){return y(),d("div",k,[c("div",S,[c("div",A,[t.isAuthed?(y(),d("div",M,[_,c("div",null,[c("label",null,[c("input",{type:"submit",class:"outline-none  border border-gray-400 border-l-0 py-2 px-10 w-full cursor-pointer",style:{"margin-top":"-6px"},value:"Выйти",onClick:e[0]||(e[0]=(...t)=>s.logout&&s.logout(...t))})])])])):(y(),d(u,{key:1},[r.loadingAdminEnter?(y(),d("div",V)):m("",!0),c("form",{onSubmit:e[3]||(e[3]=p(((...t)=>s.login&&s.login(...t)),["prevent"]))},[c("div",C,[c("div",P,[c("label",null,[h(c("input",{type:"text",class:"outline-none w-full",placeholder:"Имя пользователя","onUpdate:modelValue":e[1]||(e[1]=t=>r.adminEnterFormData.username=t)},null,512),[[g,r.adminEnterFormData.username]]),c("div",N,[c("div",null,f(r.adminEnterFormValidationErrors.username),1)])])]),c("div",G,[c("label",null,[h(c("input",{type:"password",class:"outline-none w-full",placeholder:"Пароль","onUpdate:modelValue":e[2]||(e[2]=t=>r.adminEnterFormData.password=t)},null,512),[[g,r.adminEnterFormData.password]]),c("div",O,[c("div",null,f(r.adminEnterFormValidationErrors.password),1)])])]),$])],32)],64))]),c("div",j,[r.loadingTodos?(y(),d("div",U)):m("",!0),c("div",z,[c("table",L,[c("colgroup",null,[t.isAuthed?(y(),d("col",I)):m("",!0),R,q,Z,K]),c("thead",null,[c("tr",B,[t.isAuthed?(y(),d("td",H," Выполнено ")):m("",!0),c("td",{class:"data-table-header-cell cursor-pointer",onClick:e[4]||(e[4]=t=>s.toggleSort("username"))},[J,"username"===t.sortField&&"asc"===t.sortDirection?(y(),d("span",Q,"▲")):m("",!0),"username"===t.sortField&&"desc"===t.sortDirection?(y(),d("span",W,"▼")):m("",!0)]),c("td",{class:"data-table-header-cell cursor-pointer",onClick:e[5]||(e[5]=t=>s.toggleSort("email"))},[X,"email"===t.sortField&&"asc"===t.sortDirection?(y(),d("span",Y,"▲")):m("",!0),"email"===t.sortField&&"desc"===t.sortDirection?(y(),d("span",tt,"▼")):m("",!0)]),et,c("td",{class:"data-table-header-cell cursor-pointer",onClick:e[6]||(e[6]=t=>s.toggleSort("status"))},[ot,"status"===t.sortField&&"asc"===t.sortDirection?(y(),d("span",at,"▲")):m("",!0),"status"===t.sortField&&"desc"===t.sortDirection?(y(),d("span",rt,"▼")):m("",!0)])])]),c("tbody",null,[(y(!0),d(u,null,w(t.todos,(e=>(y(),d("tr",{key:e.id,class:""},[t.isAuthed?(y(),d("td",st,[c("label",null,[c("input",{type:"checkbox",checked:e.status>=10,onClick:p((t=>s.toggleTodoCompletion(e)),["prevent"])},null,8,nt)])])):m("",!0),c("td",it,f(e.username),1),c("td",lt,f(e.email),1),t.isAuthed?(y(),d("td",dt,[c("label",null,[c("textarea",{value:e.text,class:"w-full outline-none",onChange:t=>s.changeTodoText(e,t)},null,40,ct)])])):(y(),d("td",ut,f(e.text),1)),c("td",mt,[c("div",pt,[e.status%2==1?(y(),d("span",ht,"ред")):m("",!0),e.status>=10?(y(),d("span",gt,"вып")):m("",!0)])])])))),128))])])]),c("div",ft,[c("div",null,[c("button",{onClick:e[7]||(e[7]=(...t)=>s.prevPage&&s.prevPage(...t)),class:"border border-gray-400 p-2"}," < ")]),c("div",null,f(s.page)+"/"+f(s.totalPages),1),c("div",null,[c("button",{onClick:e[8]||(e[8]=(...t)=>s.nextPage&&s.nextPage(...t)),class:"border border-gray-400 p-2"}," > ")])])]),c("div",wt,[r.loadingNewTodo?(y(),d("div",bt)):m("",!0),c("form",{onSubmit:e[12]||(e[12]=p(((...t)=>s.createTodo&&s.createTodo(...t)),["prevent"]))},[c("div",yt,[c("div",Tt,[c("label",null,[h(c("input",{type:"text",class:"outline-none w-full",placeholder:"Имя пользователя","onUpdate:modelValue":e[9]||(e[9]=t=>r.newTodoFormData.username=t)},null,512),[[g,r.newTodoFormData.username]])]),c("div",vt,[c("div",null,f(r.newTodoFormValidationErrors.username),1)])]),c("div",xt,[c("label",null,[h(c("input",{type:"text",class:"outline-none w-full",placeholder:"E-mail","onUpdate:modelValue":e[10]||(e[10]=t=>r.newTodoFormData.email=t)},null,512),[[g,r.newTodoFormData.email]]),c("div",Ft,[c("div",null,f(r.newTodoFormValidationErrors.email),1)])])]),c("div",Et,[c("label",null,[h(c("textarea",{class:"outline-none w-full resize-none",placeholder:"Текст задачи",style:{height:"100px"},"onUpdate:modelValue":e[11]||(e[11]=t=>r.newTodoFormData.text=t)},null,512),[[g,r.newTodoFormData.text]]),c("div",Dt,[c("div",null,f(r.newTodoFormValidationErrors.text),1)])])]),kt])],32)])])])};const St="https://uxcandy.com/~shapoval/test-task-backend/v2",At=T.create({baseURL:St}),Mt=T.create({baseURL:St});function _t(t){t?window.localStorage.setItem("accessToken",t):window.localStorage.removeItem("accessToken")}function Vt(){return window.localStorage.getItem("accessToken")}At.defaults.params={developer:"TretyakRoman3"},Mt.defaults.params={developer:"TretyakRoman3"},Mt.interceptors.request.use((t=>{const e=Vt();return t.data.append("token",e),t.headers["Content-Type"]="multipart/form-data",t}));const Ct=new Set;async function Pt(t,e,o){const a=await At.get("",{params:{sort_field:t,sort_direction:e,page:o}});if("ok"!==a.data.status||!("message"in a.data))throw Error;return function(t){for(const e of Ct)e(t)}(a.data.message.tasks),a.data.message.total_task_count}function Nt(t,e){const o=new URL(window.location);o.searchParams.delete(t),e&&o.searchParams.append(t,e),window.history.pushState(null,document.title,o.toString())}function Gt(t,e=null){const o=Object.fromEntries(new URL(window.location).searchParams.entries());return t in o?o[t]:e}var Ot={actions:Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",subscribeToTodos:function(t){var e;e=e=>{t.commit("todosMutation",e)},Ct.add(e)},unsubscribeToTodos:function(t){var e;e=e=>{t.commit("todosMutation",e)},Ct.delete(e)},fetchTodos:async function(t){const e=t.getters.sortFieldGetter,o=t.getters.sortDirectionGetter,a=t.getters.pageGetter;let r=await Pt(e,o,a);r<1&&(r=1),t.commit("totalTodosCountMutation",r)},loadParamsFromDocumentUrl:function(t){const e=Gt("sort-field",""),o=Gt("sort-direction","");let a=Number(Gt("page",1));a<1&&(a=1),t.commit("sortFieldMutation",e),t.commit("sortDirectionMutation",o),t.commit("pageMutation",a)},toggleSort:function(t,e){const o=t.getters.sortFieldGetter,a=t.getters.sortDirectionGetter;o!==e?(t.commit("sortFieldMutation",e),t.commit("sortDirectionMutation","desc")):"desc"===a?t.commit("sortDirectionMutation","asc"):"asc"===a&&(t.commit("sortFieldMutation",""),t.commit("sortDirectionMutation",""))},createTodo:async function(t,{username:e,email:o,text:a}){await async function(t,e,o){const a=new FormData;a.append("username",t),a.append("email",e),a.append("text",o);const r=await Mt.post("/create",a,{headers:{"Content-Type":"multipart/form-data"}});if("ok"!==r.data.status||!("message"in r.data))throw Error}(e,o,a)},updateTodo:async function(t,{todoId:e,text:o,status:a}){await async function(t,e,o){const a=new FormData;if(null!==e&&a.append("text",e),null!==o&&a.append("status",o),"ok"!==(await Mt.post(`/edit/${t}`,a,{headers:{"Content-Type":"multipart/form-data"}})).data.status)throw Error}(e,o,a)}}),getters:Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",todosGetter:function(t){return t.todos},sortFieldGetter:function(t){return t.sortField},sortDirectionGetter:function(t){return t.sortDirection},pageGetter:function(t){return t.page},totalTodosCountGetter:function(t){return t.totalTodosCount}}),mutations:Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",todosMutation:function(t,e){t.todos=e},sortFieldMutation:function(t,e){t.sortField=e,Nt("sort-field",String(e))},sortDirectionMutation:function(t,e){t.sortDirection=e,Nt("sort-direction",String(e))},pageMutation:function(t,e){t.page=e,Nt("page",String(e))},totalTodosCountMutation:function(t,e){t.totalTodosCount=e}}),state:function(){return{todos:[],sortField:null,sortDirection:null,page:null,totalTodosCount:1}}};var $t={actions:Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",checkAuthed:function(t){const e=!!Vt();t.commit("isAuthedMutation",e)},login:async function(t,{username:e,password:o}){await async function(t,e){const o=new FormData;o.append("username",t),o.append("password",e);const a=await At.post("/login",o,{headers:{"Content-Type":"multipart/form-data"}});if("ok"!==a.data.status||!("message"in a.data))throw Error;_t(a.data.message.token)}(e,o),t.commit("isAuthedMutation",!0)},logout:function(t){_t(null),t.commit("isAuthedMutation",!1)}}),getters:Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",isAuthedGetter:function(t){return t.isAuthed}}),mutations:Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",isAuthedMutation:function(t,e){t.isAuthed=e}}),state:function(){return{isAuthed:!1}}},jt=v({modules:{todo:i({namespaced:!0},Ot),auth:i({namespaced:!0},$t)}});x(F).use(jt).mount("#app");
